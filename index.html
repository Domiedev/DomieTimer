<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Timer Setup</title>
    <style>
        body {
            background-color: #2e2e2e;
            color: white;
            font-family: Arial, sans-serif;
        }
        #timerDisplay {
            font-size: 2em;
            margin: 20px;
        }
        .hidden {
            display: none;
        }
        #passwordField {
            margin: 20px;
            padding: 10px;
            background-color: #444;
            border: 1px solid #888;
            color: white;
            font-size: 1.2em;
        }
        button {
            padding: 10px;
            background-color: #444;
            color: white;
            border: 1px solid #888;
            cursor: pointer;
        }
        button:hover {
            background-color: #555;
        }
    </style>
</head>
<body>

<h1>How Long Does Domie Need?</h1>

<div id="passwordSection">
    <input type="password" id="passwordField" placeholder="Enter password">
    <button onclick="checkPassword()">Submit</button>
</div>

<div id="timerSection" class="hidden">
    <label for="timerInput">Enter timer (HH:MM:SS):</label>
    <input type="text" id="timerInput" placeholder="00:20:00">
    <button onclick="setTimer()">Set Timer</button>
    <button onclick="addFiveMinutes()">Add 5 Minutes</button>
    <div id="timerDisplay">Timer: 00:00:00</div>
</div>

<script type="module">
    // Import the functions you need from the SDKs
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-app.js";
    import { getDatabase, ref, set, get } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-database.js";

    // Your web app's Firebase configuration
    const firebaseConfig = {
        apiKey: "AIzaSyBoZI8iWOG7nFXM5vhUdJe1jMPbiBAJvVM",
        authDomain: "timer-23c1f.firebaseapp.com",
        databaseURL: "https://timer-23c1f-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "timer-23c1f",
        storageBucket: "timer-23c1f.firebasestorage.app",
        messagingSenderId: "239286947747",
        appId: "1:239286947747:web:ce78957836edcd2a7b5416"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);

    // Initialize Realtime Database
    const database = getDatabase(app);

    const password = "1234";  // Hardcoded password for simplicity

    // Function to check the password
    function checkPassword() {
        const enteredPassword = document.getElementById('passwordField').value;
        if (enteredPassword === password) {
            document.getElementById('passwordSection').classList.add('hidden');
            document.getElementById('timerSection').classList.remove('hidden');
            getTimerValue();  // Fetch the current timer value when unlocked
        } else {
            alert('Incorrect password!');
        }
    }

    // Function to set the timer value in Firebase
    function setTimer() {
        const timerInput = document.getElementById('timerInput').value;
        const timeInMillis = convertTimeToMillis(timerInput);
        setTimerValue(timeInMillis);
        displayTimer(timeInMillis);
    }

    // Convert time (HH:MM:SS) to milliseconds
    function convertTimeToMillis(time) {
        const parts = time.split(':');
        const hours = parseInt(parts[0], 10) || 0;
        const minutes = parseInt(parts[1], 10) || 0;
        const seconds = parseInt(parts[2], 10) || 0;
        return (hours * 3600 + minutes * 60 + seconds) * 1000;
    }

    // Function to display the timer
    function displayTimer(timeInMillis) {
        const hours = Math.floor(timeInMillis / 3600000);
        const minutes = Math.floor((timeInMillis % 3600000) / 60000);
        const seconds = Math.floor((timeInMillis % 60000) / 1000);
        document.getElementById('timerDisplay').textContent = `Timer: ${pad(hours)}:${pad(minutes)}:${pad(seconds)}`;
    }

    // Function to pad single-digit numbers with a leading zero
    function pad(number) {
        return number < 10 ? '0' + number : number;
    }

    // Function to add 5 minutes to the timer
    function addFiveMinutes() {
        const currentTimerValue = parseInt(localStorage.getItem('timerValue')) || 0;
        const newTimerValue = currentTimerValue + 5 * 60 * 1000;  // Adding 5 minutes in milliseconds
        setTimerValue(newTimerValue);
        displayTimer(newTimerValue);
    }

    // Function to set the timer value in Firebase
    function setTimerValue(timeInMillis) {
        const timerRef = ref(database, 'targetTime');
        set(timerRef, timeInMillis)
            .then(() => {
                console.log("Timer value saved to Firebase!");
                localStorage.setItem('timerValue', timeInMillis);  // Store locally as well
            })
            .catch((error) => {
                console.error("Error setting timer value:", error);
            });
    }

    // Function to get the timer value from Firebase
    function getTimerValue() {
        const timerRef = ref(database, 'targetTime');
        get(timerRef)
            .then((snapshot) => {
                if (snapshot.exists()) {
                    const time = snapshot.val();
                    displayTimer(time);
                } else {
                    console.log("No timer value found in the database.");
                }
            })
            .catch((error) => {
                console.error("Error getting timer value:", error);
            });
    }

</script>

</body>
</html>
